<!DOCTYPE html>
<html lang="en">
    <head>
        <title>React Standalone Template</title>
        <meta charset="UTF-8" />

        <link rel="stylesheet" href="https://unpkg.com/bootstrap@4.6.0/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-icons/font/bootstrap-icons.css" />
        <style media="all">
            .entity-card {
                width: 49%;
                margin: 0px 0.5rem 0px 0.5rem;
                display: flex;
                align-self:flex-start;
            }

            .entity-row {
                margin-bottom: 0.5rem;
                display: flex;
                justify-content: center;
            }

            .db-title {
                display: flex;
                align-items: center;
                flex-grow: 1;
                color: #FFFFFF;
                font-weight: bold;
                font-size: 1.5rem;
            }
        </style>

        <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script crossorigin src="https://unpkg.com/react/umd/react.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/jquery@3.5.1/dist/jquery.slim.min.js"></script>
        <script crossorigin src="https://unpkg.com/@popperjs/core/dist/umd/popper.min.js"></script>
        <script crossorigin src="https://unpkg.com/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
        <script crossorigin src="https://unpkg.com/react-bootstrap/dist/react-bootstrap.min.js"></script>
        <script crossorigin src="https://unpkg.com/react-router-dom/umd/react-router-dom.min.js"></script>
        <script crossorigin src="https://unpkg.com/ace-builds/src-min-noconflict/ace.js"></script>
        <script crossorigin src="https://unpkg.com/ace-builds/src-min-noconflict/mode-sql.js"></script>
        <script crossorigin src="https://unpkg.com/ace-builds/src-min-noconflict/mode-sqlserver.js"></script>
        <script crossorigin src="https://unpkg.com/ace-builds/src-min-noconflict/mode-mysql.js"></script>
        <script crossorigin src="https://unpkg.com/ace-builds/src-min-noconflict/theme-monokai.js"></script>
        <script crossorigin src="https://unpkg.com/react-ace/dist/react-ace.min.js"></script>
        <script type="text/babel" data-presets="react">
            const { Component, Fragment } = React;
            const { Navbar, Nav, Container, Row, Col, Card, Button, ButtonGroup, Table } = ReactBootstrap;
            const { HashRouter, Switch, Route, Link } = ReactRouterDOM;
            const VERSION = "v1.0";

            var AppSettings = {
                Schema: "dbo",
                SchemaSeperator: "."
            }

            var DatabaseDesign = {
                Name: "ContentManagement",
                Entities: [
                    {
                        Name: "users",
                        Columns: [
                            {
                                Name: "userid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            }
                        ]
                    },
                    {
                        Name: "content",
                        Columns: [
                            {
                                Name: "contentid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            },
                            {
                                Name: "userid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            }
                        ]
                    },
                    {
                        Name: "blah",
                        Columns: [
                            {
                                Name: "contentid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            },
                            {
                                Name: "userid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            },
                            {
                                Name: "blahid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            }
                        ]
                    },
                    {
                        Name: "free",
                        Columns: [
                            {
                                Name: "contentid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            },
                            {
                                Name: "userid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            }
                        ]
                    },
                    {
                        Name: "squee",
                        Columns: [
                            {
                                Name: "contentid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            },
                            {
                                Name: "userid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            },
                            {
                                Name: "greatid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            },
                            {
                                Name: "sighid",
                                Type: "INT(11)",
                                Flags: "Blah"
                            }
                        ]
                    }
                ]
            }
            
            

            class Application extends Component {
                constructor(props) {
                    super(props);

                    this.state = {
                        version: ""
                    }
                }

                componentDidMount() {
                    fetch(`https://api.github.com/repos/killeand/CRUDGenerator/releases/latest`, {headers:{"accept":"application/vnd.github.v3+json"}}).then((result) => {
                        return result.json();
                    }).then((data) => {
                        if (data) {
                            if (data.tag_name) {
                                this.setState({version:data.tag_name});
                            }
                            else {
                                this.setState({version:"error"});
                            }
                        }
                        else {
                            this.setState({version:"error"});
                        }
                    });
                }

                RenderVersion() {
                    if (this.state.version.length != 0) {
                        if (this.state.version == "error") {
                            return (<span className="text-danger">Error checking version online</span>);
                        }
                        else {
                            if (this.state.version == VERSION) {
                                return (<span className="text-success">Up to date!</span>);
                            }
                            else {
                                return (<span className="text-danger">Out of date! {this.state.version} on GitHub.</span>);
                            }
                        }
                    }
                }

                render() {
                    return (
                        <HashRouter>
                            <header>
                                <Navbar bg="light" variant="light">
                                    <Navbar.Brand as={Link} to="/">
                                        <span className="bi-gear-wide-connected"></span> CRUD Generator
                                    </Navbar.Brand>
                                    <Nav>
                                        <Nav.Link as={Link} to="/">Model Designer</Nav.Link>
                                        <Nav.Link as={Link} to="/output">Output</Nav.Link>
                                        <Nav.Link as={Link} to="/settings">Settings</Nav.Link>
                                    </Nav>
                                    <Navbar.Collapse className="justify-content-end">
                                        <Navbar.Text>Version: {VERSION} ({this.RenderVersion()})</Navbar.Text>
                                    </Navbar.Collapse>
                                </Navbar>
                            </header>
                            <main className="bg-light text-dark m-3 p-2 border rounded-sm">
                                <Switch>
                                    <Route exact path="/" component={ModelDesigner} />
                                    <Route exact path="/output" component={Output} />
                                    <Route exact path="/settings" component={Settings} />
                                    <Route component={FourOhFour} />
                                </Switch>
                            </main>
                            <footer className="bg-light text-dark my-3 mx-5 p-2 border rounded-sm text-center">
                                Code is open source, do with it as you will. Just give credit where credit is due.<br />
                                Powered by: <a href="https://getbootstrap.com/" className="bi-bootstrap" target="_blank">&nbsp;Bootstrap</a>, <a href="https://babeljs.io/" target="_blank">Babel</a>, <a href="https://reactjs.org/" target="_blank">React</a>, <a href="https://reactrouter.com/" target="_blank">React Router</a>, <a href="https://jquery.com/" target="_blank">JQuery</a>, <a href="https://popper.js.org/" target="_blank">PopperJS</a>, <a href="https://react-bootstrap.github.io/" target="_blank">React Bootstrap</a>, and <a href="https://ace.c9.io/" target="_blank">Ace Editor</a>/<a href="https://github.com/securingsincity/react-ace" target="_blank">React Ace</a>.<br />
                                <a href="https://github.com/killeand/CRUDGenerator" className="bi-github" target="_blank">&nbsp;See Project on GitHub.com</a>
                            </footer>
                        </HashRouter>
                    );
                }
            }

            class ModelDesigner extends Component {
                constructor(props) {
                    super(props);

                    this.state = {
                        Design: DatabaseDesign
                    }
                }

                RenderCards() {
                    if (this.state.Design.Entities.length == 0) {
                        return (<p>There are no entities</p>);
                    }
                    else {
                        let rows = [];

                        for (let i = 0; i < Math.ceil(this.state.Design.Entities.length/4); i++) {
                            let newrow = [];

                            for (let j = 0; j < 4; j++) {
                                if (this.state.Design.Entities[(i*4)+j]) {
                                    newrow.push(this.state.Design.Entities[(i*4)+j]);
                                }
                            }

                            rows.push(newrow);
                        }

                        return rows.map((row, index) => {
                            return (
                                <Row key={index} className="entity-row">
                                    {this.RenderRow(row)}
                                </Row>
                            );
                        });
                    }
                }

                RenderRow(data) {
                    return data.map((entity, index) => {
                        return (
                            <Card key={index} className="w-25 d-flex align-self-start">
                                <Card.Header className="bg-secondary text-light font-weight-bold">{AppSettings.Schema + AppSettings.SchemaSeperator + entity.Name}</Card.Header>
                                <ButtonGroup>
                                    <Button variant="success" className="bi-plus-square-fill rounded-0" />
                                    <Button variant="danger" className="bi-x-square-fill rounded-0" />
                                </ButtonGroup>
                                <Table striped bordered hover responsive variant="dark" className="m-0">
                                    <thead>
                                        <tr>
                                            <th>Column</th>
                                            <th>Type</th>
                                            <th>Flags</th>
                                            <th>&nbsp;</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {this.RenderColumns(entity.Columns)}
                                    </tbody>
                                </Table>
                            </Card>
                        );
                    });
                }

                RenderColumns(data) {
                    return data.map((column, index) => {
                        return (
                            <tr>
                                <td>{column.Name}</td>
                                <td>{column.Type}</td>
                                <td>{column.Flags}</td>
                                <td><Button variant="danger" className="bi-x-square-fill" /></td>
                            </tr>
                        );
                    });
                }

                render() {
                    return (
                        <>
                            <Container className="d-flex justify-content-end bg-secondary rounded-pill mb-3">
                                <div className="db-title">{this.state.Design.Name}</div>
                                <Button variant="danger" className="d-flex align-items-center bi-x-square-fill m-2">&nbsp;Clear Entities</Button>
                                <Button variant="success" className="d-flex align-items-center bi-plus-square-fill m-2">&nbsp;Add Entity</Button>
                            </Container>
                            <Container>
                                {this.RenderCards()}
                            </Container>
                        </>
                    );
                }
            }

            class Output extends Component {
                render() {
                    return (
                        <>
                            <p>Home Page</p>
                        </>
                    );
                }
            }

            class Settings extends Component {
                render() {
                    return (
                        <>
                            <p>Home Page</p>
                        </>
                    );
                }
            }

            class FourOhFour extends Component {
                render() {
                    return (
                        <>
                            <p>Page does not exist</p>
                        </>
                    );
                }
            }
        </script>
    </head>
    <body class="bg-dark">
        <script type="text/babel">
            ReactDOM.render(<Application />, $("body")[0]);
        </script>
    </body>
</html>